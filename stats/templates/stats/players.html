{% extends 'stats/base.html' %}
{% block content %}

{# Opcional: controles de búsqueda/orden que ya tenías #}

<div class="sort-tabs">
  <a href="?sort=games" class="btn {% if sort == 'games' %}active{% endif %}">Juegos</a>
  <a href="?sort=goals" class="btn {% if sort == 'goals' %}active{% endif %}">Goles</a>
</div>


<section class="players-grid">
  {% for row in rows %}
    {% with p=row.player %}
    <article class="player-card" data-toggle-row aria-expanded="false">
      <div class="pc-left">
        {% if p.photo %}
          <img src="{{ p.photo.url }}" alt="{{ p.short_name }}" class="avatar-xl">
        {% else %}
          <div class="avatar-xl placeholder">#{{ p.number }}</div>
        {% endif %}
      </div>

      <div class="pc-mid">
        <div class="pc-name">
          <a href="{% url 'player_detail' p.pk %}">{{ p.short_name }}</a>
          <span class="pc-number">#{{ p.number }}</span>
        </div>
        <div class="pc-kpis">
          <span class="kpi"><strong>PJ</strong> {{ p.gp }}</span>
          <span class="kpi"><strong>G</strong> {{ p.goals_total }}</span>
          <span class="kpi"><strong>G/M</strong> {{ row.gpm }}</span>
        </div>
      </div>

      <div class="pc-right">
        <button class="pc-toggle" type="button" aria-label="Ver partidos">Ver</button>
      </div>
    </article>

    <div class="detail-row">
      <div class="detail-card">
        <div class="detail-title">Partidos</div>
        <ul class="detail-list">
          {% for a in row.apps %}
            <li class="{% if a.goals > 0 %}scored{% endif %}">
              <span class="muted">J{{ a.game.jornada }}</span>
              <span class="opponent">{{ a.game.opponent.name }}</span>
              <span class="date">{{ a.game.date|date:'Y-m-d' }}</span>
              <span class="goals">{{ a.goals }}</span>
            </li>
          {% empty %}
            <li class="muted">Sin participaciones</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endwith %}
  {% empty %}
    <p class="muted">Sin jugadores.</p>
  {% endfor %}
</section>

{% endblock %}